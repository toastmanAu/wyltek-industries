<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CKB Node Sync â€” Wyltek Industries</title>
  <meta name="description" content="Fast-sync your Nervos CKB full node or Neuron wallet with a verified, GPG-signed snapshot. Windows, macOS, and Linux supported." />
  <link rel="canonical" href="https://wyltekindustries.com/ckb-sync" />
  <style>
    :root {
      --bg:#0a0c0f;--surface:#111318;--surface2:#181c23;--border:#1e2430;
      --accent:#00c8ff;--accent2:#7b5cfa;--green:#00e5a0;--orange:#ff8c42;
      --red:#ff4f4f;--text:#e2e8f0;--muted:#64748b;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:var(--bg);color:var(--text);font-family:'Segoe UI',system-ui,sans-serif;min-height:100vh}
    nav{display:flex;align-items:center;justify-content:space-between;padding:1rem 2rem;
        border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg);z-index:100}
    .nav-logo{font-weight:700;font-size:1.1rem;color:var(--accent);text-decoration:none}
    .nav-links{display:flex;gap:1.5rem}
    .nav-links a{color:var(--muted);text-decoration:none;font-size:.9rem;transition:color .2s}
    .nav-links a:hover{color:var(--text)}
    .hero{text-align:center;padding:4rem 2rem 2rem;max-width:800px;margin:0 auto}
    .hero-badge{display:inline-block;background:rgba(0,200,255,.1);border:1px solid rgba(0,200,255,.3);
        color:var(--accent);padding:.3rem .9rem;border-radius:999px;font-size:.8rem;
        font-weight:600;letter-spacing:.05em;text-transform:uppercase;margin-bottom:1.2rem}
    h1{font-size:clamp(1.8rem,5vw,2.8rem);font-weight:800;line-height:1.15;margin-bottom:1rem}
    h1 span{color:var(--accent)}
    .hero p{color:var(--muted);font-size:1.05rem;line-height:1.7;max-width:600px;margin:0 auto 2rem}
    .app-selector{display:flex;gap:.75rem;justify-content:center;flex-wrap:wrap;margin:0 auto 2.5rem;max-width:680px;padding:0 1rem}
    .app-btn{display:flex;align-items:center;gap:.5rem;padding:.6rem 1.4rem;border-radius:10px;
        border:1px solid var(--border);background:var(--surface);color:var(--muted);
        font-size:.9rem;cursor:pointer;transition:all .2s;user-select:none}
    .app-btn:hover{border-color:var(--accent);color:var(--text)}
    .app-btn.active{border-color:var(--accent);color:var(--accent);background:rgba(0,200,255,.08)}
    .snapshot-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;
        max-width:680px;margin:0 auto 3rem;overflow:hidden}
    .snapshot-header{background:var(--surface2);border-bottom:1px solid var(--border);
        padding:1.2rem 1.5rem;display:flex;align-items:center;gap:.8rem}
    .status-dot{width:10px;height:10px;border-radius:50%;background:var(--green);
        box-shadow:0 0 8px var(--green);animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
    .snapshot-header h2{font-size:1rem;font-weight:600}
    .snapshot-header .updated{margin-left:auto;color:var(--muted);font-size:.8rem}
    .snapshot-body{padding:1.5rem}
    .stat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1.5rem}
    .stat{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:1rem;text-align:center}
    .stat-value{font-size:1.4rem;font-weight:700;color:var(--accent)}
    .stat-label{font-size:.75rem;color:var(--muted);margin-top:.25rem}
    .badges{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1.5rem}
    .badge{display:flex;align-items:center;gap:.3rem;background:rgba(0,229,160,.08);
        border:1px solid rgba(0,229,160,.25);color:var(--green);padding:.25rem .7rem;
        border-radius:6px;font-size:.78rem;font-weight:500}
    .os-row{display:flex;gap:.5rem;margin-bottom:.75rem;flex-wrap:wrap}
    .os-btn{padding:.45rem .9rem;border-radius:8px;border:1px solid var(--border);
        background:var(--surface2);color:var(--muted);font-size:.82rem;cursor:pointer;
        transition:all .2s;user-select:none}
    .os-btn:hover{border-color:var(--accent2);color:var(--text)}
    .os-btn.active{border-color:var(--accent2);color:var(--accent2);background:rgba(123,92,250,.1)}
    .path-row{display:flex;align-items:center;gap:.5rem;background:var(--bg);
        border:1px solid var(--border);border-radius:8px;padding:.6rem .8rem;margin-bottom:1rem}
    .path-label{font-size:.75rem;color:var(--muted);white-space:nowrap}
    .path-value{font-family:monospace;font-size:.8rem;color:var(--accent);flex:1;word-break:break-all}
    .path-edit-btn{background:none;border:1px solid var(--border);border-radius:6px;color:var(--muted);
        font-size:.75rem;padding:.2rem .5rem;cursor:pointer;white-space:nowrap;transition:all .2s}
    .path-edit-btn:hover{border-color:var(--accent);color:var(--accent)}
    .warn-box{background:rgba(255,140,66,.08);border:1px solid rgba(255,140,66,.3);border-radius:8px;
        padding:.75rem 1rem;font-size:.83rem;color:var(--orange);margin-bottom:1rem;line-height:1.6}
    .filename-box{background:var(--bg);border:1px solid var(--border);border-radius:8px;
        padding:.75rem 1rem;font-family:monospace;font-size:.8rem;color:var(--muted);
        word-break:break-all;margin-bottom:1rem}
    .filename-box span{color:var(--accent)}
    .dl-btn{display:flex;align-items:center;justify-content:center;gap:.6rem;width:100%;
        padding:1rem 1.5rem;background:linear-gradient(135deg,var(--accent),var(--accent2));
        color:#fff;font-size:1rem;font-weight:700;border:none;border-radius:10px;cursor:pointer;
        text-decoration:none;transition:opacity .2s,transform .1s;margin-bottom:.75rem}
    .dl-btn:hover{opacity:.9;transform:translateY(-1px)}
    .dl-sub{display:flex;gap:.5rem;margin-bottom:1.5rem}
    .dl-sub a{flex:1;text-align:center;padding:.6rem;background:var(--surface2);
        border:1px solid var(--border);border-radius:8px;color:var(--muted);font-size:.8rem;
        text-decoration:none;transition:color .2s,border-color .2s}
    .dl-sub a:hover{color:var(--text);border-color:var(--accent)}
    .tabs{display:flex;margin-bottom:1.5rem;border-bottom:1px solid var(--border);overflow-x:auto}
    .tab{padding:.6rem 1rem;font-size:.82rem;color:var(--muted);cursor:pointer;
        border-bottom:2px solid transparent;margin-bottom:-1px;transition:color .2s;
        user-select:none;white-space:nowrap}
    .tab.active{color:var(--accent);border-bottom-color:var(--accent)}
    .tab-content{display:none}
    .tab-content.active{display:block}
    pre{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:1rem;
        font-size:.82rem;overflow-x:auto;line-height:1.7;color:#a0b0c0;position:relative}
    .cm{color:var(--muted)} .kw{color:var(--accent)} .st{color:var(--green)}
    .error-msg{display:none;background:rgba(255,79,79,.08);border:1px solid rgba(255,79,79,.3);
        border-radius:8px;padding:.75rem 1rem;font-size:.85rem;color:var(--red);margin-bottom:1rem}
    .error-msg.show{display:block}
    .section{max-width:680px;margin:0 auto 2.5rem;padding:0 1rem}
    .section h3{font-size:1.1rem;font-weight:700;margin-bottom:1rem}
    .method-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    .method-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:1.2rem}
    .method-card h4{font-size:.95rem;margin-bottom:.5rem}
    .method-card p{font-size:.82rem;color:var(--muted);line-height:1.6}
    .mtag{display:inline-block;padding:.15rem .5rem;border-radius:4px;font-size:.7rem;font-weight:600;margin-bottom:.5rem}
    .tag-fast{background:rgba(0,229,160,.1);color:var(--green)}
    .tag-trust{background:rgba(0,200,255,.1);color:var(--accent)}
    .security-box{background:rgba(0,229,160,.05);border:1px solid rgba(0,229,160,.2);
        border-radius:10px;padding:1.2rem;font-size:.85rem;line-height:1.7;color:var(--muted)}
    .security-box strong{color:var(--text)}
    footer{text-align:center;padding:2rem;color:var(--muted);font-size:.8rem;
        border-top:1px solid var(--border);margin-top:3rem}
    footer a{color:var(--muted);text-decoration:none}
    footer a:hover{color:var(--accent)}
    @media(max-width:600px){
      .stat-grid{grid-template-columns:repeat(2,1fr)}
      .method-grid{grid-template-columns:1fr}
      .dl-sub{flex-direction:column}
    }
  
    /* â”€â”€ Nav toggle (mobile) â”€â”€ */
    .nav-toggle {
      display: none;
      background: none; border: none; cursor: pointer;
      font-size: 1.4rem; color: var(--text, #e2e8f0);
      padding: 0.2rem 0.4rem; line-height: 1;
    }
    @media (max-width: 700px) {
      nav#mainNav { display: none; flex-direction: column; gap: 0; position: absolute;
        top: 100%; left: 0; right: 0; background: var(--surface, #0f1117);
        border-bottom: 1px solid var(--border, #1e2430); padding: 0.5rem 0; z-index: 999; }
      nav#mainNav.open { display: flex; }
      nav#mainNav a { padding: 0.7rem 1.5rem; font-size: 1rem; border-bottom: 1px solid var(--border, #1e2430); }
      nav#mainNav a:last-child { border-bottom: none; }
      .nav-toggle { display: block; }
      .header-inner { position: relative; }
    }
  </style>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#07090f">
</head>
<body>

    <nav id="mainNav">
      <a href="index.html">Home</a>
      <a href="blog.html">Devlog</a>
      <a href="blackbox.html">BlackBox</a>
      <a href="ckb-sync.html" class="active">CKB Sync</a>
      <a href="flasher.html">Flasher</a>
      <a href="hardware.html">Hardware</a>
      <a href="images.html">Images</a>
      <a href="https://github.com/toastmanAu" target="_blank">GitHub â†—</a>
    </nav>
    <button class="nav-toggle" id="navToggle" aria-label="Toggle menu">&#9776;</button><div class="hero">
  <div class="hero-badge">âš¡ Fast Node Sync</div>
  <h1>CKB Full Node <span>Sync Tool</span></h1>
  <p>Skip days of syncing. Download a verified, GPG-signed Nervos CKB chain snapshot and be up in hours. Works with Neuron wallet, bare CKB nodes, and SBCs on Windows, macOS, and Linux.</p>
</div>

<!-- App selector -->
<div class="app-selector">
  <div class="app-btn active" onclick="selectApp('ckb')" id="app-ckb">
    <span>â¬¡</span> CKB Full Node
  </div>
  <div class="app-btn" onclick="selectApp('neuron')" id="app-neuron">
    <span>ğŸ§ </span> Neuron Wallet
  </div>
</div>

<!-- Main card -->
<div class="snapshot-card">
  <div class="snapshot-header">
    <div class="status-dot" id="statusDot"></div>
    <h2 id="snapshotTitle">Loading latest snapshot...</h2>
    <span class="updated" id="snapshotDate"></span>
  </div>
  <div class="snapshot-body">

    <div class="stat-grid">
      <div class="stat"><div class="stat-value" id="blockHeight">â€”</div><div class="stat-label">Block Height</div></div>
      <div class="stat"><div class="stat-value" id="snapSize">~47 GB</div><div class="stat-label">Compressed</div></div>
      <div class="stat"><div class="stat-value" id="snapAge">â€”</div><div class="stat-label">Snapshot Age</div></div>
      <div class="stat"><div class="stat-value" id="nextSnap">â€”</div><div class="stat-label">Next Snapshot</div></div>
    </div>

    <div class="badges">
      <div class="badge">ğŸ›¡ SHA256 Verified</div>
      <div class="badge">ğŸ”‘ GPG Signed</div>
      <div class="badge">â™¾ Free Egress</div>
      <div class="badge">â¸ Resumable</div>
    </div>

    <div class="error-msg" id="errorMsg">âš  Could not load snapshot info â€” check back shortly or download from the source link below.</div>

    <!-- OS selector -->
    <div style="font-size:.8rem;color:var(--muted);margin-bottom:.5rem">Your platform:</div>
    <div class="os-row">
      <div class="os-btn" id="os-windows" onclick="selectOS('windows')">ğŸªŸ Windows</div>
      <div class="os-btn" id="os-macos"   onclick="selectOS('macos')">ğŸ macOS</div>
      <div class="os-btn" id="os-linux"   onclick="selectOS('linux')">ğŸ§ Linux</div>
      <div class="os-btn" id="os-sbc"     onclick="selectOS('sbc')">ğŸŠ SBC</div>
    </div>

    <!-- Data path -->
    <div class="path-row">
      <span class="path-label">Data folder:</span>
      <span class="path-value" id="dataPath">â€”</span>
      <button class="path-edit-btn" onclick="editPath()">âœ Edit</button>
    </div>

    <!-- Neuron warning -->
    <div class="warn-box" id="neuronWarn" style="display:none">
      âš  <strong>Quit Neuron completely</strong> before extracting â€” right-click the tray icon â†’ Quit. The built-in node must not be running when you replace chain data.
    </div>

    <div class="filename-box" id="filenameBox"><span>fetching snapshot info...</span></div>

    <a class="dl-btn" id="dlBtn" href="#" onclick="return false;">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="7 10 12 15 17 10"/>
        <line x1="12" y1="15" x2="12" y2="3"/>
      </svg>
      Download Snapshot
    </a>

    <div class="dl-sub">
      <a href="#" id="sha256Link">SHA256</a>
      <a href="#" id="sigLink">GPG Sig</a>
      <a href="#" id="metaLink">Metadata</a>
      <a href="https://github.com/toastmanAu/ckb-snapshot" target="_blank">Source</a>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab active" onclick="switchTab('install')">Install</div>
      <div class="tab" onclick="switchTab('verify')">Verify</div>
      <div class="tab" onclick="switchTab('assume')">Trustless Sync</div>
    </div>

    <div class="tab-content active" id="tab-install">
      <pre id="installCode"><span class="cm"># Select your platform above</span></pre>
    </div>

    <div class="tab-content" id="tab-verify">
      <pre id="verifyCode"><span class="cm"># Select your platform above</span></pre>
    </div>

    <div class="tab-content" id="tab-assume">
<pre><span class="cm"># Trustless fast sync â€” no snapshot needed.
# PoW is fully verified. Same model as Bitcoin assumevalid.
#
# Add to ckb.toml (CKB node) or Neuron's node configuration:</span>

[sync]
assume_valid_target = <span class="st" id="preAssumeHash">"0x&lt;recent-block-hash&gt;"</span>

<span class="cm"># Get a block hash from the snapshot metadata:</span>
<span class="kw">curl</span> -s https://snapshots.wyltekindustries.com/latest.json

<span class="cm"># Or find one at: https://explorer.nervos.org</span></pre>
    </div>

  </div>
</div>

<!-- Methods -->
<div class="section">
  <h3>Which method is right for you?</h3>
  <div class="method-grid">
    <div class="method-card">
      <div class="mtag tag-fast">âš¡ Fastest</div>
      <h4>Snapshot (this page)</h4>
      <p>Pre-synced chain DB. Up in 2-3 hours. Works for Neuron, bare CKB, or SBC nodes. Verify before use.</p>
    </div>
    <div class="method-card">
      <div class="mtag tag-trust">ğŸ”’ Trustless</div>
      <h4>assume_valid_target</h4>
      <p>One line in ckb.toml. Syncs in hours from peers â€” no download. PoW fully verified the whole time.</p>
    </div>
    <div class="method-card">
      <div class="mtag tag-trust">ğŸŒ± Full Verify</div>
      <h4>Sync from Genesis</h4>
      <p>Every block verified from block 0. Takes 3-7 days on SBCs, hours on a desktop. Best for archive nodes.</p>
    </div>
    <div class="method-card">
      <div class="mtag tag-fast">ğŸ¤– Coming Soon</div>
      <h4>Golden SBC Image</h4>
      <p>Pre-built Armbian for Orange Pi 3B with CKB + snapshot pre-loaded. Flash and go.</p>
    </div>
  </div>
</div>

<!-- Security -->
<div class="section">
  <h3>Security model</h3>
  <div class="security-box">
    <strong>Every snapshot is signed.</strong> SHA256 checksum GPG-signed by key <code style="color:var(--accent)">CFF9573B87BB90B7</code> (toastmanAu CKB Snapshots). Verify fingerprint via <a href="https://github.com/toastmanAu" style="color:var(--accent)">GitHub</a> or Nervos Nation TG.<br><br>
    <strong>You don't have to trust us.</strong> Use <code style="color:var(--accent)">assume_valid_target</code> â€” same speed, zero dependency on this service. PoW verified by your node either way.<br><br>
    <strong>Resume support.</strong> HTTP Range requests supported. Use <code style="color:var(--accent)">wget -c</code>, <code style="color:var(--accent)">curl -C -</code>, or aria2c to resume dropped downloads.
  </div>
</div>

<footer>
  <p>Wyltek Industries â€” <a href="/">wyltekindustries.com</a> Â· <a href="https://github.com/toastmanAu/ckb-snapshot" target="_blank">ckb-snapshot on GitHub</a> Â· Hosted on <a href="https://developers.cloudflare.com/r2/" target="_blank">Cloudflare R2</a></p>
  <p style="margin-top:.5rem">Community service â€” not an official Nervos Foundation product.</p>
  <p style="margin-top:.8rem;font-size:.78rem;opacity:.7">Built in the Nervos CKB ecosystem Â· <a href="https://nervos.org" target="_blank">nervos.org</a></p>
</footer>

<script>
const R2_BASE    = 'https://snapshots.wyltekindustries.com';
const LATEST_URL = R2_BASE + '/latest.json';

// â”€â”€ Data paths â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PATHS = {
  neuron: {
    windows: '%APPDATA%\\Neuron\\chains\\mainnet\\data',
    macos:   '~/Library/Application Support/Neuron/chains/mainnet/data',
    linux:   '~/.config/Neuron/chains/mainnet/data',
    sbc:     '~/.config/Neuron/chains/mainnet/data',
  },
  ckb: {
    windows: '%USERPROFILE%\\.ckb\\data',
    macos:   '~/.ckb/data',
    linux:   '~/.ckb/data',
    sbc:     '~/.ckb/data',
  }
};

// â”€â”€ Build instructions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildInstall(app, os, path, url, filename) {
  const isWin = os === 'windows';
  const isSBC = os === 'sbc';
  const dl = isWin
    ? `<span class="cm"># Recommended: aria2c for resumable downloads\n# winget install --id=aria2.aria2 (run once)</span>\n<span class="kw">aria2c</span> -c <span class="st">"${url}"</span>\n\n<span class="cm"># Or PowerShell (no resume):</span>\n<span class="kw">Invoke-WebRequest</span> -Uri <span class="st">"${url}"</span> -OutFile <span class="st">"${filename}"</span>`
    : `<span class="kw">wget</span> -c <span class="st">"${url}"</span>`;

  const stop = isWin && app === 'neuron'
    ? `<span class="cm"># Right-click Neuron in system tray â†’ Quit</span>`
    : isWin && app === 'ckb'
    ? `<span class="kw">Stop-Process</span> -Name ckb -ErrorAction SilentlyContinue`
    : isSBC
    ? `<span class="kw">sudo systemctl</span> stop ckb`
    : app === 'neuron'
    ? `<span class="cm"># Quit Neuron from menu/tray before continuing</span>`
    : `<span class="kw">pkill</span> -f ckb <span class="cm">|| true  # or: sudo systemctl stop ckb</span>`;

  const extract = isWin
    ? `<span class="cm"># Install zstd: winget install --id=Facebook.Zstd</span>\n<span class="kw">tar</span> --use-compress-program="zstd -d" -xf <span class="st">"${filename}"</span> -C <span class="st">"${path}"</span>`
    : os === 'macos'
    ? `<span class="cm"># Install zstd if needed: brew install zstd</span>\n<span class="kw">tar</span> --use-compress-program=zstd -xf <span class="st">"${filename}"</span> -C <span class="st">"${path}"</span>`
    : `<span class="cm"># Install zstd if needed: sudo apt install zstd</span>\n<span class="kw">tar</span> --use-compress-program=zstd -xf <span class="st">"${filename}"</span> -C <span class="st">"${path}"</span>`;

  const start = isWin && app === 'neuron'
    ? `<span class="cm"># Relaunch Neuron â€” it auto-starts its built-in node</span>`
    : isWin && app === 'ckb'
    ? `<span class="kw">.\\ckb.exe</span> run`
    : isSBC
    ? `<span class="kw">sudo systemctl</span> start ckb`
    : app === 'neuron'
    ? `<span class="cm"># Relaunch Neuron</span>`
    : `<span class="kw">ckb</span> run <span class="cm"># or: sudo systemctl start ckb</span>`;

  return `<span class="cm"># Step 1 â€” Stop the node</span>\n${stop}\n\n<span class="cm"># Step 2 â€” Download snapshot (resumable)</span>\n${dl}\n\n<span class="cm"># Step 3 â€” Verify checksum</span>\n${isWin
    ? `<span class="kw">Get-FileHash</span> <span class="st">"${filename}"</span> -Algorithm SHA256\n<span class="cm"># Compare output with: ${filename}.sha256</span>`
    : `<span class="kw">sha256sum</span> -c <span class="st">"${filename}.sha256"</span>`}\n\n<span class="cm"># Step 4 â€” Extract into data folder</span>\n${extract}\n\n<span class="cm"># Step 5 â€” Start the node</span>\n${start}`;
}

function buildVerify(os, filename) {
  const isWin = os === 'windows';
  return isWin
    ? `<span class="cm"># Import signing key (one time) â€” requires Gpg4win: https://gpg4win.org</span>\n<span class="kw">gpg</span> --keyserver keys.openpgp.org --recv-keys CFF9573B87BB90B7\n\n<span class="cm"># Verify GPG signature</span>\n<span class="kw">gpg</span> --verify <span class="st">"${filename}.sha256.sig"</span> <span class="st">"${filename}.sha256"</span>\n\n<span class="cm"># Verify checksum</span>\n<span class="kw">Get-FileHash</span> <span class="st">"${filename}"</span> -Algorithm SHA256\n<span class="cm"># Compare with contents of ${filename}.sha256</span>`
    : `<span class="cm"># Import signing key (one time)</span>\n<span class="kw">gpg</span> --keyserver keys.openpgp.org --recv-keys CFF9573B87BB90B7\n\n<span class="cm"># Verify GPG signature</span>\n<span class="kw">gpg</span> --verify <span class="st">"${filename}.sha256.sig"</span> <span class="st">"${filename}.sha256"</span>\n\n<span class="cm"># Verify checksum</span>\n<span class="kw">sha256sum</span> -c <span class="st">"${filename}.sha256"</span>\n\n<span class="cm"># Expected fingerprint:\n# F2B5 7AC3 35D8 2A28 31E1 04BA CFF9 573B 87BB 90B7\n# uid: toastmanAu CKB Snapshots &lt;toastmanau@wyltekindustries.com&gt;</span>`;
}

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let S = { app: 'ckb', os: detectOS(), customPath: null, url: '', filename: '' };

function detectOS() {
  const ua = navigator.userAgent.toLowerCase();
  if (ua.includes('win')) return 'windows';
  if (ua.includes('mac')) return 'macos';
  return 'linux';
}

function getPath() {
  return S.customPath || PATHS[S.app][S.os] || '~/.ckb/data';
}

function render() {
  ['windows','macos','linux','sbc'].forEach(o =>
    document.getElementById('os-'+o).classList.toggle('active', S.os===o));
  ['ckb','neuron'].forEach(a =>
    document.getElementById('app-'+a).classList.toggle('active', S.app===a));

  document.getElementById('dataPath').textContent = getPath();
  document.getElementById('neuronWarn').style.display = S.app==='neuron' ? 'block' : 'none';

  if (S.filename) {
    document.getElementById('installCode').innerHTML =
      buildInstall(S.app, S.os, getPath(), S.url, S.filename);
    document.getElementById('verifyCode').innerHTML =
      buildVerify(S.os, S.filename);
  }
}

function selectApp(app) { S.app = app; S.customPath = null; render(); }
function selectOS(os)   { S.os  = os;  S.customPath = null; render(); }

function editPath() {
  const cur = getPath();
  const val = prompt('Enter your CKB data folder path:', cur);
  if (val && val.trim()) { S.customPath = val.trim(); render(); }
}

function switchTab(name) {
  document.querySelectorAll('.tab').forEach((t,i) => {
    t.classList.toggle('active', ['install','verify','assume'][i]===name);
  });
  document.querySelectorAll('.tab-content').forEach(c => {
    c.classList.toggle('active', c.id==='tab-'+name);
  });
}

// â”€â”€ Load snapshot metadata â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadSnapshot() {
  try {
    const res = await fetch(LATEST_URL, { cache: 'no-cache' });
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();

    S.url      = data.snapshot_url;
    S.filename = data.latest;

    document.getElementById('blockHeight').textContent = Number(data.block_height).toLocaleString();
    document.getElementById('snapshotTitle').textContent = 'Latest Snapshot Ready';
    document.getElementById('snapshotDate').textContent  = 'Updated ' + data.date;

    const days = Math.floor((Date.now() - new Date(
      data.date.replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3')
    )) / 86400000);
    document.getElementById('snapAge').textContent = days === 0 ? 'Today' : days + 'd ago';

    // Next snapshot: weekly Sunday 2am ACST (UTC+10:30 = UTC+630min)
    function nextSnapshotLabel(fromDateStr) {
      // Parse snapshot date as YYYYMMDD
      const m = fromDateStr.match(/(\d{4})(\d{2})(\d{2})/);
      const base = m ? new Date(Date.UTC(+m[1], +m[2]-1, +m[3], 0, 0, 0)) : new Date();
      // Find next Sunday at 2am ACST = 15:30 UTC (Sun + 15h30m UTC)
      const next = new Date(base);
      next.setUTCHours(15, 30, 0, 0);
      // Advance to next Sunday (day 0)
      const dow = next.getUTCDay(); // 0=Sun
      const daysUntilSun = dow === 0 ? 7 : (7 - dow);
      next.setUTCDate(next.getUTCDate() + daysUntilSun);
      // How far away is that from now?
      const diffMs = next - Date.now();
      if (diffMs < 0) return 'Soon';
      const diffDays = Math.floor(diffMs / 86400000);
      const diffHrs  = Math.floor((diffMs % 86400000) / 3600000);
      if (diffDays === 0) return diffHrs + 'h';
      if (diffDays === 1) return '1d ' + diffHrs + 'h';
      return diffDays + 'd';
    }
    document.getElementById('nextSnap').textContent = nextSnapshotLabel(data.date);

    document.getElementById('filenameBox').innerHTML =
      '<span style="color:var(--muted)">File: </span><span>' + data.latest + '</span>';

    const btn = document.getElementById('dlBtn');
    btn.href = data.snapshot_url;
    btn.onclick = null;
    btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> Download Snapshot (~47 GB)';

    document.getElementById('sha256Link').href = data.sha256_url;
    document.getElementById('sigLink').href    = data.sig_url;
    document.getElementById('metaLink').href   = data.meta_url;
    document.getElementById('preAssumeHash').textContent = '"0x<block-hash-from-metadata>"';

    render();
  } catch(e) {
    document.getElementById('statusDot').style.cssText = 'background:var(--red);box-shadow:0 0 8px var(--red)';
    document.getElementById('snapshotTitle').textContent = 'Snapshot service unavailable';
    document.getElementById('nextSnap').textContent = 'Sun 2am';
    document.getElementById('errorMsg').classList.add('show');
    document.getElementById('filenameBox').innerHTML =
      '<span>Check: <a style="color:var(--accent)" href="' + R2_BASE + '/latest.json">' + R2_BASE + '/latest.json</a></span>';
  }
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
selectOS(detectOS());
loadSnapshot();
</script>
  <script>
    (function(){
      var btn = document.getElementById('navToggle');
      var nav = document.getElementById('mainNav');
      if(btn && nav) btn.addEventListener('click', function(){
        nav.classList.toggle('open');
      });
      // close on outside click
      document.addEventListener('click', function(e){
        if(nav && btn && !nav.contains(e.target) && e.target !== btn) nav.classList.remove('open');
      });
    })();
  </script>
</body>
</html>